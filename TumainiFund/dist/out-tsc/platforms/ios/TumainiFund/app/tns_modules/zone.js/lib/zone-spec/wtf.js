/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
/**
 * @fileoverview
 * @suppress {missingRequire}
 */
(function (global) {
    // Detect and setup WTF.
    let wtfTrace = null;
    let wtfEvents = null;
    const wtfEnabled = (function () {
        const wtf = global['wtf'];
        if (wtf) {
            wtfTrace = wtf.trace;
            if (wtfTrace) {
                wtfEvents = wtfTrace.events;
                return true;
            }
        }
        return false;
    })();
    class WtfZoneSpec {
        constructor() {
            this.name = 'WTF';
        }
        onFork(parentZoneDelegate, currentZone, targetZone, zoneSpec) {
            const retValue = parentZoneDelegate.fork(targetZone, zoneSpec);
            WtfZoneSpec.forkInstance(zonePathName(targetZone), retValue.name);
            return retValue;
        }
        onInvoke(parentZoneDelegate, currentZone, targetZone, delegate, applyThis, applyArgs, source) {
            const src = source || 'unknown';
            let scope = WtfZoneSpec.invokeScope[src];
            if (!scope) {
                scope = WtfZoneSpec.invokeScope[src] =
                    wtfEvents.createScope(`Zone:invoke:${source}(ascii zone)`);
            }
            return wtfTrace.leaveScope(scope(zonePathName(targetZone)), parentZoneDelegate.invoke(targetZone, delegate, applyThis, applyArgs, source));
        }
        onHandleError(parentZoneDelegate, currentZone, targetZone, error) {
            return parentZoneDelegate.handleError(targetZone, error);
        }
        onScheduleTask(parentZoneDelegate, currentZone, targetZone, task) {
            const key = task.type + ':' + task.source;
            let instance = WtfZoneSpec.scheduleInstance[key];
            if (!instance) {
                instance = WtfZoneSpec.scheduleInstance[key] =
                    wtfEvents.createInstance(`Zone:schedule:${key}(ascii zone, any data)`);
            }
            const retValue = parentZoneDelegate.scheduleTask(targetZone, task);
            instance(zonePathName(targetZone), shallowObj(task.data, 2));
            return retValue;
        }
        onInvokeTask(parentZoneDelegate, currentZone, targetZone, task, applyThis, applyArgs) {
            const source = task.source;
            let scope = WtfZoneSpec.invokeTaskScope[source];
            if (!scope) {
                scope = WtfZoneSpec.invokeTaskScope[source] =
                    wtfEvents.createScope(`Zone:invokeTask:${source}(ascii zone)`);
            }
            return wtfTrace.leaveScope(scope(zonePathName(targetZone)), parentZoneDelegate.invokeTask(targetZone, task, applyThis, applyArgs));
        }
        onCancelTask(parentZoneDelegate, currentZone, targetZone, task) {
            const key = task.source;
            let instance = WtfZoneSpec.cancelInstance[key];
            if (!instance) {
                instance = WtfZoneSpec.cancelInstance[key] =
                    wtfEvents.createInstance(`Zone:cancel:${key}(ascii zone, any options)`);
            }
            const retValue = parentZoneDelegate.cancelTask(targetZone, task);
            instance(zonePathName(targetZone), shallowObj(task.data, 2));
            return retValue;
        }
    }
    WtfZoneSpec.forkInstance = wtfEnabled ? wtfEvents.createInstance('Zone:fork(ascii zone, ascii newZone)') : null;
    WtfZoneSpec.scheduleInstance = {};
    WtfZoneSpec.cancelInstance = {};
    WtfZoneSpec.invokeScope = {};
    WtfZoneSpec.invokeTaskScope = {};
    function shallowObj(obj, depth) {
        if (!obj || !depth)
            return null;
        const out = {};
        for (const key in obj) {
            if (obj.hasOwnProperty(key)) {
                let value = obj[key];
                switch (typeof value) {
                    case 'object':
                        const name = value && value.constructor && value.constructor.name;
                        value = name == Object.name ? shallowObj(value, depth - 1) : name;
                        break;
                    case 'function':
                        value = value.name || undefined;
                        break;
                }
                out[key] = value;
            }
        }
        return out;
    }
    function zonePathName(zone) {
        let name = zone.name;
        let localZone = zone.parent;
        while (localZone != null) {
            name = localZone.name + '::' + name;
            localZone = localZone.parent;
        }
        return name;
    }
    Zone['wtfZoneSpec'] = !wtfEnabled ? null : new WtfZoneSpec();
})(typeof window === 'object' && window || typeof self === 'object' && self || global);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid3RmLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGxhdGZvcm1zL2lvcy9UdW1haW5pRnVuZC9hcHAvdG5zX21vZHVsZXMvem9uZS5qcy9saWIvem9uZS1zcGVjL3d0Zi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7QUFDSDs7O0dBR0c7QUFFSCxDQUFDLFVBQVMsTUFBVztJQW9CckIsd0JBQXdCO0lBQ3hCLElBQUksUUFBUSxHQUFrQixJQUFJLENBQUM7SUFDbkMsSUFBSSxTQUFTLEdBQW1CLElBQUksQ0FBQztJQUNyQyxNQUFNLFVBQVUsR0FBWSxDQUFDO1FBQzNCLE1BQU0sR0FBRyxHQUFRLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvQixJQUFJLEdBQUcsRUFBRTtZQUNQLFFBQVEsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1lBQ3JCLElBQUksUUFBUSxFQUFFO2dCQUNaLFNBQVMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO2dCQUM1QixPQUFPLElBQUksQ0FBQzthQUNiO1NBQ0Y7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFFTCxNQUFNLFdBQVc7UUFBakI7WUFDRSxTQUFJLEdBQVcsS0FBSyxDQUFDO1FBNEV2QixDQUFDO1FBbkVDLE1BQU0sQ0FBQyxrQkFBZ0MsRUFBRSxXQUFpQixFQUFFLFVBQWdCLEVBQUUsUUFBa0I7WUFFOUYsTUFBTSxRQUFRLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMvRCxXQUFXLENBQUMsWUFBYSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbkUsT0FBTyxRQUFRLENBQUM7UUFDbEIsQ0FBQztRQUVELFFBQVEsQ0FDSixrQkFBZ0MsRUFBRSxXQUFpQixFQUFFLFVBQWdCLEVBQUUsUUFBa0IsRUFDekYsU0FBYyxFQUFFLFNBQWlCLEVBQUUsTUFBZTtZQUNwRCxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksU0FBUyxDQUFDO1lBQ2hDLElBQUksS0FBSyxHQUFHLFdBQVcsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDekMsSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDVixLQUFLLEdBQUcsV0FBVyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUM7b0JBQ2hDLFNBQVUsQ0FBQyxXQUFXLENBQUMsZUFBZSxNQUFNLGNBQWMsQ0FBQyxDQUFDO2FBQ2pFO1lBQ0QsT0FBTyxRQUFTLENBQUMsVUFBVSxDQUN2QixLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQy9CLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNyRixDQUFDO1FBR0QsYUFBYSxDQUFDLGtCQUFnQyxFQUFFLFdBQWlCLEVBQUUsVUFBZ0IsRUFBRSxLQUFVO1lBRTdGLE9BQU8sa0JBQWtCLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMzRCxDQUFDO1FBRUQsY0FBYyxDQUFDLGtCQUFnQyxFQUFFLFdBQWlCLEVBQUUsVUFBZ0IsRUFBRSxJQUFVO1lBRTlGLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDMUMsSUFBSSxRQUFRLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pELElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2IsUUFBUSxHQUFHLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUM7b0JBQ3hDLFNBQVUsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLEdBQUcsd0JBQXdCLENBQUMsQ0FBQzthQUM3RTtZQUNELE1BQU0sUUFBUSxHQUFHLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDbkUsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdELE9BQU8sUUFBUSxDQUFDO1FBQ2xCLENBQUM7UUFHRCxZQUFZLENBQ1Isa0JBQWdDLEVBQUUsV0FBaUIsRUFBRSxVQUFnQixFQUFFLElBQVUsRUFDakYsU0FBZSxFQUFFLFNBQWlCO1lBQ3BDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDM0IsSUFBSSxLQUFLLEdBQUcsV0FBVyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoRCxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNWLEtBQUssR0FBRyxXQUFXLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQztvQkFDdkMsU0FBVSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsTUFBTSxjQUFjLENBQUMsQ0FBQzthQUNyRTtZQUNELE9BQU8sUUFBUyxDQUFDLFVBQVUsQ0FDdkIsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUMvQixrQkFBa0IsQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUM3RSxDQUFDO1FBRUQsWUFBWSxDQUFDLGtCQUFnQyxFQUFFLFdBQWlCLEVBQUUsVUFBZ0IsRUFBRSxJQUFVO1lBRTVGLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDeEIsSUFBSSxRQUFRLEdBQUcsV0FBVyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMvQyxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNiLFFBQVEsR0FBRyxXQUFXLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQztvQkFDdEMsU0FBVSxDQUFDLGNBQWMsQ0FBQyxlQUFlLEdBQUcsMkJBQTJCLENBQUMsQ0FBQzthQUM5RTtZQUNELE1BQU0sUUFBUSxHQUFHLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDakUsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdELE9BQU8sUUFBUSxDQUFDO1FBQ2xCLENBQUM7O0lBekVNLHdCQUFZLEdBQ2YsVUFBVSxDQUFDLENBQUMsQ0FBQyxTQUFVLENBQUMsY0FBYyxDQUFDLHNDQUFzQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNuRiw0QkFBZ0IsR0FBZ0MsRUFBRSxDQUFDO0lBQ25ELDBCQUFjLEdBQWdDLEVBQUUsQ0FBQztJQUNqRCx1QkFBVyxHQUFnQyxFQUFFLENBQUM7SUFDOUMsMkJBQWUsR0FBZ0MsRUFBRSxDQUFDO0lBdUUzRCxTQUFTLFVBQVUsQ0FBQyxHQUFpQyxFQUFFLEtBQWE7UUFDbEUsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPLElBQUksQ0FBQztRQUNoQyxNQUFNLEdBQUcsR0FBdUIsRUFBRSxDQUFDO1FBQ25DLEtBQUssTUFBTSxHQUFHLElBQUksR0FBRyxFQUFFO1lBQ3JCLElBQUksR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDM0IsSUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNyQixRQUFRLE9BQU8sS0FBSyxFQUFFO29CQUNwQixLQUFLLFFBQVE7d0JBQ1gsTUFBTSxJQUFJLEdBQUcsS0FBSyxJQUFJLEtBQUssQ0FBQyxXQUFXLElBQVUsS0FBSyxDQUFDLFdBQVksQ0FBQyxJQUFJLENBQUM7d0JBQ3pFLEtBQUssR0FBRyxJQUFJLElBQVUsTUFBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQzt3QkFDekUsTUFBTTtvQkFDUixLQUFLLFVBQVU7d0JBQ2IsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLElBQUksU0FBUyxDQUFDO3dCQUNoQyxNQUFNO2lCQUNUO2dCQUNELEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7YUFDbEI7U0FDRjtRQUNELE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztJQUVELFNBQVMsWUFBWSxDQUFDLElBQVU7UUFDOUIsSUFBSSxJQUFJLEdBQVcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM3QixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzVCLE9BQU8sU0FBUyxJQUFJLElBQUksRUFBRTtZQUN4QixJQUFJLEdBQUcsU0FBUyxDQUFDLElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ3BDLFNBQVMsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDO1NBQzlCO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUEsSUFBWSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksV0FBVyxFQUFFLENBQUM7QUFDdEUsQ0FBQyxDQUFDLENBQUMsT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLE1BQU0sSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3XG4gKiBAc3VwcHJlc3Mge21pc3NpbmdSZXF1aXJlfVxuICovXG5cbihmdW5jdGlvbihnbG9iYWw6IGFueSkge1xuaW50ZXJmYWNlIFd0ZiB7XG4gIHRyYWNlOiBXdGZUcmFjZTtcbn1cbmludGVyZmFjZSBXdGZTY29wZSB7fVxuaW50ZXJmYWNlIFd0ZlJhbmdlIHt9XG5pbnRlcmZhY2UgV3RmVHJhY2Uge1xuICBldmVudHM6IFd0ZkV2ZW50cztcbiAgbGVhdmVTY29wZShzY29wZTogV3RmU2NvcGUsIHJldHVyblZhbHVlPzogYW55KTogdm9pZDtcbiAgYmVnaW5UaW1lUmFuZ2UocmFuZ2VUeXBlOiBzdHJpbmcsIGFjdGlvbjogc3RyaW5nKTogV3RmUmFuZ2U7XG4gIGVuZFRpbWVSYW5nZShyYW5nZTogV3RmUmFuZ2UpOiB2b2lkO1xufVxuaW50ZXJmYWNlIFd0ZkV2ZW50cyB7XG4gIGNyZWF0ZVNjb3BlKHNpZ25hdHVyZTogc3RyaW5nLCBmbGFncz86IGFueSk6IFd0ZlNjb3BlRm47XG4gIGNyZWF0ZUluc3RhbmNlKHNpZ25hdHVyZTogc3RyaW5nLCBmbGFncz86IGFueSk6IFd0ZkV2ZW50Rm47XG59XG5cbnR5cGUgV3RmU2NvcGVGbiA9ICguLi5hcmdzOiBhbnlbXSkgPT4gV3RmU2NvcGU7XG50eXBlIFd0ZkV2ZW50Rm4gPSAoLi4uYXJnczogYW55W10pID0+IGFueTtcblxuLy8gRGV0ZWN0IGFuZCBzZXR1cCBXVEYuXG5sZXQgd3RmVHJhY2U6IFd0ZlRyYWNlfG51bGwgPSBudWxsO1xubGV0IHd0ZkV2ZW50czogV3RmRXZlbnRzfG51bGwgPSBudWxsO1xuY29uc3Qgd3RmRW5hYmxlZDogYm9vbGVhbiA9IChmdW5jdGlvbigpOiBib29sZWFuIHtcbiAgY29uc3Qgd3RmOiBXdGYgPSBnbG9iYWxbJ3d0ZiddO1xuICBpZiAod3RmKSB7XG4gICAgd3RmVHJhY2UgPSB3dGYudHJhY2U7XG4gICAgaWYgKHd0ZlRyYWNlKSB7XG4gICAgICB3dGZFdmVudHMgPSB3dGZUcmFjZS5ldmVudHM7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufSkoKTtcblxuY2xhc3MgV3RmWm9uZVNwZWMgaW1wbGVtZW50cyBab25lU3BlYyB7XG4gIG5hbWU6IHN0cmluZyA9ICdXVEYnO1xuXG4gIHN0YXRpYyBmb3JrSW5zdGFuY2UgPVxuICAgICAgd3RmRW5hYmxlZCA/IHd0ZkV2ZW50cyEuY3JlYXRlSW5zdGFuY2UoJ1pvbmU6Zm9yayhhc2NpaSB6b25lLCBhc2NpaSBuZXdab25lKScpIDogbnVsbDtcbiAgc3RhdGljIHNjaGVkdWxlSW5zdGFuY2U6IHtba2V5OiBzdHJpbmddOiBXdGZFdmVudEZufSA9IHt9O1xuICBzdGF0aWMgY2FuY2VsSW5zdGFuY2U6IHtba2V5OiBzdHJpbmddOiBXdGZFdmVudEZufSA9IHt9O1xuICBzdGF0aWMgaW52b2tlU2NvcGU6IHtba2V5OiBzdHJpbmddOiBXdGZFdmVudEZufSA9IHt9O1xuICBzdGF0aWMgaW52b2tlVGFza1Njb3BlOiB7W2tleTogc3RyaW5nXTogV3RmRXZlbnRGbn0gPSB7fTtcblxuICBvbkZvcmsocGFyZW50Wm9uZURlbGVnYXRlOiBab25lRGVsZWdhdGUsIGN1cnJlbnRab25lOiBab25lLCB0YXJnZXRab25lOiBab25lLCB6b25lU3BlYzogWm9uZVNwZWMpOlxuICAgICAgWm9uZSB7XG4gICAgY29uc3QgcmV0VmFsdWUgPSBwYXJlbnRab25lRGVsZWdhdGUuZm9yayh0YXJnZXRab25lLCB6b25lU3BlYyk7XG4gICAgV3RmWm9uZVNwZWMuZm9ya0luc3RhbmNlISh6b25lUGF0aE5hbWUodGFyZ2V0Wm9uZSksIHJldFZhbHVlLm5hbWUpO1xuICAgIHJldHVybiByZXRWYWx1ZTtcbiAgfVxuXG4gIG9uSW52b2tlKFxuICAgICAgcGFyZW50Wm9uZURlbGVnYXRlOiBab25lRGVsZWdhdGUsIGN1cnJlbnRab25lOiBab25lLCB0YXJnZXRab25lOiBab25lLCBkZWxlZ2F0ZTogRnVuY3Rpb24sXG4gICAgICBhcHBseVRoaXM6IGFueSwgYXBwbHlBcmdzPzogYW55W10sIHNvdXJjZT86IHN0cmluZyk6IGFueSB7XG4gICAgY29uc3Qgc3JjID0gc291cmNlIHx8ICd1bmtub3duJztcbiAgICBsZXQgc2NvcGUgPSBXdGZab25lU3BlYy5pbnZva2VTY29wZVtzcmNdO1xuICAgIGlmICghc2NvcGUpIHtcbiAgICAgIHNjb3BlID0gV3RmWm9uZVNwZWMuaW52b2tlU2NvcGVbc3JjXSA9XG4gICAgICAgICAgd3RmRXZlbnRzIS5jcmVhdGVTY29wZShgWm9uZTppbnZva2U6JHtzb3VyY2V9KGFzY2lpIHpvbmUpYCk7XG4gICAgfVxuICAgIHJldHVybiB3dGZUcmFjZSEubGVhdmVTY29wZShcbiAgICAgICAgc2NvcGUoem9uZVBhdGhOYW1lKHRhcmdldFpvbmUpKSxcbiAgICAgICAgcGFyZW50Wm9uZURlbGVnYXRlLmludm9rZSh0YXJnZXRab25lLCBkZWxlZ2F0ZSwgYXBwbHlUaGlzLCBhcHBseUFyZ3MsIHNvdXJjZSkpO1xuICB9XG5cblxuICBvbkhhbmRsZUVycm9yKHBhcmVudFpvbmVEZWxlZ2F0ZTogWm9uZURlbGVnYXRlLCBjdXJyZW50Wm9uZTogWm9uZSwgdGFyZ2V0Wm9uZTogWm9uZSwgZXJyb3I6IGFueSk6XG4gICAgICBib29sZWFuIHtcbiAgICByZXR1cm4gcGFyZW50Wm9uZURlbGVnYXRlLmhhbmRsZUVycm9yKHRhcmdldFpvbmUsIGVycm9yKTtcbiAgfVxuXG4gIG9uU2NoZWR1bGVUYXNrKHBhcmVudFpvbmVEZWxlZ2F0ZTogWm9uZURlbGVnYXRlLCBjdXJyZW50Wm9uZTogWm9uZSwgdGFyZ2V0Wm9uZTogWm9uZSwgdGFzazogVGFzayk6XG4gICAgICBhbnkge1xuICAgIGNvbnN0IGtleSA9IHRhc2sudHlwZSArICc6JyArIHRhc2suc291cmNlO1xuICAgIGxldCBpbnN0YW5jZSA9IFd0ZlpvbmVTcGVjLnNjaGVkdWxlSW5zdGFuY2Vba2V5XTtcbiAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICBpbnN0YW5jZSA9IFd0ZlpvbmVTcGVjLnNjaGVkdWxlSW5zdGFuY2Vba2V5XSA9XG4gICAgICAgICAgd3RmRXZlbnRzIS5jcmVhdGVJbnN0YW5jZShgWm9uZTpzY2hlZHVsZToke2tleX0oYXNjaWkgem9uZSwgYW55IGRhdGEpYCk7XG4gICAgfVxuICAgIGNvbnN0IHJldFZhbHVlID0gcGFyZW50Wm9uZURlbGVnYXRlLnNjaGVkdWxlVGFzayh0YXJnZXRab25lLCB0YXNrKTtcbiAgICBpbnN0YW5jZSh6b25lUGF0aE5hbWUodGFyZ2V0Wm9uZSksIHNoYWxsb3dPYmoodGFzay5kYXRhLCAyKSk7XG4gICAgcmV0dXJuIHJldFZhbHVlO1xuICB9XG5cblxuICBvbkludm9rZVRhc2soXG4gICAgICBwYXJlbnRab25lRGVsZWdhdGU6IFpvbmVEZWxlZ2F0ZSwgY3VycmVudFpvbmU6IFpvbmUsIHRhcmdldFpvbmU6IFpvbmUsIHRhc2s6IFRhc2ssXG4gICAgICBhcHBseVRoaXM/OiBhbnksIGFwcGx5QXJncz86IGFueVtdKTogYW55IHtcbiAgICBjb25zdCBzb3VyY2UgPSB0YXNrLnNvdXJjZTtcbiAgICBsZXQgc2NvcGUgPSBXdGZab25lU3BlYy5pbnZva2VUYXNrU2NvcGVbc291cmNlXTtcbiAgICBpZiAoIXNjb3BlKSB7XG4gICAgICBzY29wZSA9IFd0ZlpvbmVTcGVjLmludm9rZVRhc2tTY29wZVtzb3VyY2VdID1cbiAgICAgICAgICB3dGZFdmVudHMhLmNyZWF0ZVNjb3BlKGBab25lOmludm9rZVRhc2s6JHtzb3VyY2V9KGFzY2lpIHpvbmUpYCk7XG4gICAgfVxuICAgIHJldHVybiB3dGZUcmFjZSEubGVhdmVTY29wZShcbiAgICAgICAgc2NvcGUoem9uZVBhdGhOYW1lKHRhcmdldFpvbmUpKSxcbiAgICAgICAgcGFyZW50Wm9uZURlbGVnYXRlLmludm9rZVRhc2sodGFyZ2V0Wm9uZSwgdGFzaywgYXBwbHlUaGlzLCBhcHBseUFyZ3MpKTtcbiAgfVxuXG4gIG9uQ2FuY2VsVGFzayhwYXJlbnRab25lRGVsZWdhdGU6IFpvbmVEZWxlZ2F0ZSwgY3VycmVudFpvbmU6IFpvbmUsIHRhcmdldFpvbmU6IFpvbmUsIHRhc2s6IFRhc2spOlxuICAgICAgYW55IHtcbiAgICBjb25zdCBrZXkgPSB0YXNrLnNvdXJjZTtcbiAgICBsZXQgaW5zdGFuY2UgPSBXdGZab25lU3BlYy5jYW5jZWxJbnN0YW5jZVtrZXldO1xuICAgIGlmICghaW5zdGFuY2UpIHtcbiAgICAgIGluc3RhbmNlID0gV3RmWm9uZVNwZWMuY2FuY2VsSW5zdGFuY2Vba2V5XSA9XG4gICAgICAgICAgd3RmRXZlbnRzIS5jcmVhdGVJbnN0YW5jZShgWm9uZTpjYW5jZWw6JHtrZXl9KGFzY2lpIHpvbmUsIGFueSBvcHRpb25zKWApO1xuICAgIH1cbiAgICBjb25zdCByZXRWYWx1ZSA9IHBhcmVudFpvbmVEZWxlZ2F0ZS5jYW5jZWxUYXNrKHRhcmdldFpvbmUsIHRhc2spO1xuICAgIGluc3RhbmNlKHpvbmVQYXRoTmFtZSh0YXJnZXRab25lKSwgc2hhbGxvd09iaih0YXNrLmRhdGEsIDIpKTtcbiAgICByZXR1cm4gcmV0VmFsdWU7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2hhbGxvd09iaihvYmo6IHtbazogc3RyaW5nXTogYW55fXx1bmRlZmluZWQsIGRlcHRoOiBudW1iZXIpOiBhbnkge1xuICBpZiAoIW9iaiB8fCAhZGVwdGgpIHJldHVybiBudWxsO1xuICBjb25zdCBvdXQ6IHtbazogc3RyaW5nXTogYW55fSA9IHt9O1xuICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgIGxldCB2YWx1ZSA9IG9ialtrZXldO1xuICAgICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHtcbiAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICBjb25zdCBuYW1lID0gdmFsdWUgJiYgdmFsdWUuY29uc3RydWN0b3IgJiYgKDxhbnk+dmFsdWUuY29uc3RydWN0b3IpLm5hbWU7XG4gICAgICAgICAgdmFsdWUgPSBuYW1lID09ICg8YW55Pk9iamVjdCkubmFtZSA/IHNoYWxsb3dPYmoodmFsdWUsIGRlcHRoIC0gMSkgOiBuYW1lO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgICAgdmFsdWUgPSB2YWx1ZS5uYW1lIHx8IHVuZGVmaW5lZDtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIG91dFtrZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBvdXQ7XG59XG5cbmZ1bmN0aW9uIHpvbmVQYXRoTmFtZSh6b25lOiBab25lKSB7XG4gIGxldCBuYW1lOiBzdHJpbmcgPSB6b25lLm5hbWU7XG4gIGxldCBsb2NhbFpvbmUgPSB6b25lLnBhcmVudDtcbiAgd2hpbGUgKGxvY2FsWm9uZSAhPSBudWxsKSB7XG4gICAgbmFtZSA9IGxvY2FsWm9uZS5uYW1lICsgJzo6JyArIG5hbWU7XG4gICAgbG9jYWxab25lID0gbG9jYWxab25lLnBhcmVudDtcbiAgfVxuICByZXR1cm4gbmFtZTtcbn1cblxuKFpvbmUgYXMgYW55KVsnd3RmWm9uZVNwZWMnXSA9ICF3dGZFbmFibGVkID8gbnVsbCA6IG5ldyBXdGZab25lU3BlYygpO1xufSkodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcgJiYgd2luZG93IHx8IHR5cGVvZiBzZWxmID09PSAnb2JqZWN0JyAmJiBzZWxmIHx8IGdsb2JhbCk7XG4iXX0=